<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mock Design Interview 模擬設計面試 — 系統架構圖解</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang HK", "Microsoft JhengHei", sans-serif; background: #0f1117; color: #e0e0e0; min-height: 100vh; }
    .container { max-width: 960px; margin: 0 auto; padding: 40px 24px; }
    header { text-align: center; margin-bottom: 40px; }
    header h1 { font-size: 2rem; font-weight: 700; color: #ffffff; margin-bottom: 8px; }
    header p { font-size: 1rem; color: #9ca3af; line-height: 1.6; }
    .card { background: #1a1d27; border-radius: 16px; padding: 32px; margin-bottom: 24px; border: 1px solid #2a2d3a; }
    .card h2 { font-size: 1.5rem; color: #ffffff; margin-bottom: 8px; }
    .card .subtitle { font-size: 0.95rem; color: #6366f1; font-weight: 500; margin-bottom: 16px; }
    .card p { font-size: 0.95rem; color: #c0c4cc; line-height: 1.8; margin-bottom: 12px; }

    /* Timer */
    .timer-bar { display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 24px; }
    .timer-display { font-family: 'JetBrains Mono', 'Courier New', monospace; font-size: 3.5rem; font-weight: 700; color: #6366f1; letter-spacing: 4px; transition: color 0.5s ease; user-select: none; }
    .timer-display.warning { color: #fbbf24; }
    .timer-display.danger { color: #f87171; }
    .timer-label { font-size: 0.85rem; color: #9ca3af; text-align: center; margin-top: 4px; }

    /* Controls */
    .controls { display: flex; gap: 12px; align-items: center; justify-content: center; flex-wrap: wrap; margin-bottom: 24px; }
    .select-topic { background: #13151c; color: #e0e0e0; border: 1px solid #2a2d3a; border-radius: 10px; padding: 12px 16px; font-size: 0.95rem; font-family: inherit; cursor: pointer; min-width: 260px; appearance: none; -webkit-appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath d='M2 4l4 4 4-4' fill='none' stroke='%239ca3af' stroke-width='1.5'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 14px center; padding-right: 36px; }
    .select-topic:focus { outline: none; border-color: #6366f1; }
    .select-topic option { background: #1a1d27; color: #e0e0e0; }

    .btn { padding: 12px 24px; border: none; border-radius: 10px; font-size: 0.95rem; font-weight: 600; cursor: pointer; font-family: inherit; transition: all 0.25s ease; }
    .btn-primary { background: #6366f1; color: #ffffff; }
    .btn-primary:hover { background: #4f46e5; }
    .btn-primary:disabled { background: #3730a3; opacity: 0.5; cursor: not-allowed; }
    .btn-secondary { background: #13151c; color: #c0c4cc; border: 1px solid #2a2d3a; }
    .btn-secondary:hover { background: #1e2130; border-color: #6366f1; color: #e0e0e0; }
    .btn-danger { background: rgba(248, 113, 113, 0.15); color: #f87171; border: 1px solid rgba(248, 113, 113, 0.3); }
    .btn-danger:hover { background: rgba(248, 113, 113, 0.25); }

    /* Prompt */
    .prompt-box { background: linear-gradient(135deg, rgba(99, 102, 241, 0.12), rgba(99, 102, 241, 0.04)); border-left: 4px solid #6366f1; border-radius: 0 12px 12px 0; padding: 24px 28px; margin-bottom: 24px; display: none; }
    .prompt-box.visible { display: block; animation: fadeSlideIn 0.4s ease; }
    .prompt-box h3 { color: #a5b4fc; font-size: 1.1rem; margin-bottom: 10px; }
    .prompt-box .prompt-text { font-size: 1.05rem; color: #e0e0e0; line-height: 1.8; font-weight: 500; }

    /* Hints */
    .hints-container { margin-bottom: 24px; }
    .hint-card { background: #13151c; border-radius: 12px; padding: 18px 22px; margin-bottom: 12px; border: 1px solid #2a2d3a; border-left: 3px solid #fbbf24; display: none; }
    .hint-card.visible { display: block; animation: fadeSlideIn 0.5s ease; }
    .hint-card .hint-time { font-size: 0.8rem; color: #fbbf24; font-weight: 600; margin-bottom: 6px; font-family: 'JetBrains Mono', 'Courier New', monospace; }
    .hint-card .hint-text { font-size: 0.92rem; color: #c0c4cc; line-height: 1.7; }

    /* Notepad */
    .notepad-section { margin-bottom: 24px; display: none; }
    .notepad-section.visible { display: block; animation: fadeSlideIn 0.4s ease; }
    .notepad-section h3 { color: #ffffff; font-size: 1.1rem; margin-bottom: 12px; }
    .notepad { width: 100%; min-height: 320px; background: #13151c; border: 1px solid #2a2d3a; border-radius: 12px; padding: 20px; font-size: 0.92rem; font-family: 'JetBrains Mono', 'Courier New', monospace; color: #e0e0e0; line-height: 1.8; resize: vertical; transition: border-color 0.25s ease; }
    .notepad:focus { outline: none; border-color: #6366f1; }
    .notepad::placeholder { color: #4b5563; }

    /* Reference Answer */
    .reference-section { display: none; margin-bottom: 24px; }
    .reference-section.visible { display: block; animation: fadeSlideIn 0.5s ease; }
    .checklist { list-style: none; padding: 0; }
    .checklist li { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid #2a2d3a; font-size: 0.95rem; color: #c0c4cc; line-height: 1.6; cursor: pointer; transition: color 0.2s ease; }
    .checklist li:last-child { border-bottom: none; }
    .checklist li:hover { color: #e0e0e0; }
    .checklist input[type="checkbox"] { appearance: none; -webkit-appearance: none; width: 22px; height: 22px; border: 2px solid #2a2d3a; border-radius: 6px; background: #13151c; cursor: pointer; flex-shrink: 0; position: relative; transition: all 0.2s ease; }
    .checklist input[type="checkbox"]:checked { background: #6366f1; border-color: #6366f1; }
    .checklist input[type="checkbox"]:checked::after { content: ''; position: absolute; top: 3px; left: 7px; width: 5px; height: 10px; border: solid #fff; border-width: 0 2px 2px 0; transform: rotate(45deg); }
    .checklist li.checked { color: #6366f1; text-decoration: line-through; text-decoration-color: rgba(99, 102, 241, 0.4); }

    /* Score bar */
    .score-bar { margin-top: 16px; display: flex; align-items: center; gap: 12px; }
    .score-track { flex: 1; height: 8px; background: #13151c; border-radius: 4px; overflow: hidden; }
    .score-fill { height: 100%; background: linear-gradient(90deg, #6366f1, #a5b4fc); border-radius: 4px; transition: width 0.4s ease; width: 0%; }
    .score-text { font-size: 0.85rem; color: #9ca3af; font-family: 'JetBrains Mono', 'Courier New', monospace; min-width: 48px; text-align: right; }

    /* Status badge */
    .status-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; margin-left: 12px; }
    .status-badge.running { background: rgba(99, 102, 241, 0.15); color: #a5b4fc; }
    .status-badge.paused { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }
    .status-badge.ended { background: rgba(248, 113, 113, 0.15); color: #f87171; }

    /* Animations */
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Responsive */
    @media (max-width: 600px) {
      .container { padding: 24px 16px; }
      header h1 { font-size: 1.5rem; }
      .card { padding: 20px; }
      .timer-display { font-size: 2.5rem; }
      .select-topic { min-width: 100%; }
      .controls { flex-direction: column; }
      .controls .btn { width: 100%; }
      .notepad { min-height: 220px; }
    }

    /* Related topics */
    .related-topics { margin-top: 32px; }
    .related-topics h3 { color: #ffffff; font-size: 1.1rem; margin-bottom: 14px; }
    .related-links { display: flex; flex-wrap: wrap; gap: 10px; }
    .related-link { display: inline-block; padding: 8px 16px; background: #13151c; border: 1px solid #2a2d3a; border-radius: 20px; color: #a5b4fc; font-size: 0.85rem; text-decoration: none; transition: all 0.2s ease; }
    .related-link:hover { background: #6366f1; color: #ffffff; border-color: #6366f1; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <header>
      <h1>Mock Design Interview 模擬設計面試</h1>
      <p>限時 35 分鐘，挑戰真實系統設計面試場景</p>
    </header>

    <!-- Topic Selector & Controls -->
    <div class="card" id="setup-card">
      <h2>選擇設計題目</h2>
      <div class="subtitle">揀一個題目，開始計時挑戰</div>
      <div class="controls">
        <select class="select-topic" id="topic-select">
          <option value="" disabled selected>-- 揀一個設計題目 --</option>
          <option value="url-shortener">URL Shortener 短網址服務</option>
          <option value="chat-system">Chat System 即時通訊</option>
          <option value="payment-system">Payment System 支付系統</option>
          <option value="news-feed">News Feed 動態消息</option>
        </select>
        <button class="btn btn-primary" id="start-btn" disabled>開始計時</button>
      </div>
    </div>

    <!-- Timer Display -->
    <div class="card" id="timer-card" style="display:none; text-align:center;">
      <div class="timer-bar">
        <div>
          <div class="timer-display" id="timer-display">35:00</div>
          <div class="timer-label">剩餘時間<span class="status-badge running" id="status-badge">進行中</span></div>
        </div>
      </div>
      <div class="controls">
        <button class="btn btn-secondary" id="pause-btn">暫停</button>
        <button class="btn btn-secondary" id="show-answer-btn">提前睇答案</button>
        <button class="btn btn-danger" id="reset-btn">重新開始</button>
      </div>
    </div>

    <!-- Design Prompt -->
    <div class="prompt-box" id="prompt-box">
      <h3 id="prompt-title"></h3>
      <div class="prompt-text" id="prompt-text"></div>
    </div>

    <!-- Progressive Hints -->
    <div class="hints-container" id="hints-container">
      <div class="hint-card" id="hint-0">
        <div class="hint-time"></div>
        <div class="hint-text"></div>
      </div>
      <div class="hint-card" id="hint-1">
        <div class="hint-time"></div>
        <div class="hint-text"></div>
      </div>
      <div class="hint-card" id="hint-2">
        <div class="hint-time"></div>
        <div class="hint-text"></div>
      </div>
    </div>

    <!-- Notepad -->
    <div class="notepad-section" id="notepad-section">
      <div class="card">
        <h2>設計筆記</h2>
        <div class="subtitle">寫低你嘅設計思路、架構、trade-off</div>
        <textarea class="notepad" id="notepad" placeholder="喺度寫低你嘅設計方案...&#10;&#10;建議結構：&#10;1. 需求分析 (Functional / Non-functional)&#10;2. 容量估算 (QPS / Storage / Bandwidth)&#10;3. API 設計&#10;4. 數據模型&#10;5. 高層架構圖&#10;6. 深入設計重點組件&#10;7. 擴展性 / 監控 / 告警"></textarea>
      </div>
    </div>

    <!-- Reference Answer -->
    <div class="reference-section" id="reference-section">
      <div class="card">
        <h2>參考答案 Checklist</h2>
        <div class="subtitle">睇下你涵蓋咗幾多重點</div>
        <ul class="checklist" id="checklist"></ul>
        <div class="score-bar">
          <div class="score-track">
            <div class="score-fill" id="score-fill"></div>
          </div>
          <div class="score-text" id="score-text">0 / 0</div>
        </div>
      </div>
    </div>

    <!-- Related Topics -->
    <div class="related-topics">
      <div class="card">
        <h3>相關課題</h3>
        <div class="related-links">
          <a href="url-shortener.html" class="related-link">URL Shortener 短網址</a>
          <a href="chat-system.html" class="related-link">Chat System 即時通訊</a>
          <a href="payment-system.html" class="related-link">Payment System 支付</a>
          <a href="news-feed.html" class="related-link">News Feed 動態消息</a>
          <a href="load-balancer.html" class="related-link">Load Balancer 負載均衡</a>
        </div>
      </div>
    </div>
  </div>

  <script src="../premium-gate.js"></script>
  <script>
    // ── Mock Design Data ──
    const mockDesigns = {
      'url-shortener': {
        title: 'URL Shortener 短網址服務',
        prompt: '設計一個 URL 短網址服務，支援每日 1 億個短網址生成。',
        hints: [
          { at: 25, text: '記得考慮 ID 生成策略：自增 ID vs Hash vs Base62' },
          { at: 15, text: '讀寫比例？Cache 策略？Analytics tracking？' },
          { at: 5, text: '301 vs 302 redirect？過期清理？Rate limiting？' }
        ],
        checklist: [
          'API 設計 (POST /shorten, GET /:id)',
          'ID 生成 (Base62 / Snowflake)',
          '存儲 (KV Store / SQL)',
          'Cache 層 (Redis + LRU)',
          '301 vs 302 trade-off',
          'Analytics / 統計',
          '過期同清理策略',
          'Rate Limiting'
        ]
      },
      'chat-system': {
        title: 'Chat System 即時通訊',
        prompt: '設計一個支援 1 對 1 同群組聊天嘅即時通訊系統，支援 1000 萬日活用戶。',
        hints: [
          { at: 25, text: '考慮 WebSocket vs Long Polling vs SSE' },
          { at: 15, text: '離線消息存儲？已讀回執？群組消息扇出？' },
          { at: 5, text: 'Message ordering？Media 上傳？Push notification？' }
        ],
        checklist: [
          '連接方案 (WebSocket + fallback)',
          '消息存儲 (Cassandra / HBase)',
          '消息 ID 同排序',
          '群組消息扇出策略',
          '離線消息同 Push Notification',
          '已讀回執',
          '媒體文件上傳 (Object Storage)',
          'Rate Limiting 同 Spam 防護'
        ]
      },
      'payment-system': {
        title: 'Payment System 支付系統',
        prompt: '設計一個電商平台嘅支付系統，支援多種支付方式，每日處理 100 萬筆交易。',
        hints: [
          { at: 25, text: '考慮 idempotency key 確保唔會重複扣款' },
          { at: 15, text: '支付狀態機？Webhook callback？Reconciliation？' },
          { at: 5, text: '退款流程？Ledger 設計？PCI compliance？' }
        ],
        checklist: [
          'Payment 狀態機設計',
          'Idempotency Key',
          '第三方支付 Gateway 整合',
          'Webhook 同 callback 處理',
          'Ledger / 賬本設計',
          '退款流程',
          'Reconciliation 對賬',
          'PCI DSS compliance'
        ]
      },
      'news-feed': {
        title: 'News Feed 動態消息',
        prompt: '設計一個類似 Facebook / Instagram 嘅 News Feed 系統，支援 5 億用戶。',
        hints: [
          { at: 25, text: 'Fan-out on write vs Fan-out on read？' },
          { at: 15, text: 'Ranking algorithm？Cache 策略？Pagination？' },
          { at: 5, text: 'Celebrity problem？Real-time updates？' }
        ],
        checklist: [
          'Feed 生成方案 (Fan-out)',
          'Feed 存儲 (Redis list / Cassandra)',
          'Ranking / 排序演算法',
          'Cache 策略 (多層)',
          'Celebrity / 大 V 問題',
          'Pagination (Cursor-based)',
          'Real-time 更新 (Long polling)',
          'Media 處理同 CDN'
        ]
      }
    };

    // ── State ──
    let timerInterval = null;
    let totalSeconds = 35 * 60;
    let remainingSeconds = totalSeconds;
    let isPaused = false;
    let currentTopic = null;
    let hintsShown = [false, false, false];

    // ── DOM Refs ──
    const topicSelect = document.getElementById('topic-select');
    const startBtn = document.getElementById('start-btn');
    const timerCard = document.getElementById('timer-card');
    const timerDisplay = document.getElementById('timer-display');
    const statusBadge = document.getElementById('status-badge');
    const pauseBtn = document.getElementById('pause-btn');
    const showAnswerBtn = document.getElementById('show-answer-btn');
    const resetBtn = document.getElementById('reset-btn');
    const promptBox = document.getElementById('prompt-box');
    const promptTitle = document.getElementById('prompt-title');
    const promptText = document.getElementById('prompt-text');
    const notepadSection = document.getElementById('notepad-section');
    const notepad = document.getElementById('notepad');
    const referenceSection = document.getElementById('reference-section');
    const checklistEl = document.getElementById('checklist');
    const scoreFill = document.getElementById('score-fill');
    const scoreText = document.getElementById('score-text');

    // ── Enable start button when topic selected ──
    topicSelect.addEventListener('change', () => {
      startBtn.disabled = !topicSelect.value;
    });

    // ── Start ──
    startBtn.addEventListener('click', () => {
      const key = topicSelect.value;
      if (!key || !mockDesigns[key]) return;
      currentTopic = mockDesigns[key];
      remainingSeconds = totalSeconds;
      isPaused = false;
      hintsShown = [false, false, false];

      // Show UI
      timerCard.style.display = '';
      promptTitle.textContent = currentTopic.title;
      promptText.textContent = currentTopic.prompt;
      promptBox.classList.add('visible');
      notepadSection.classList.add('visible');
      notepad.value = '';
      referenceSection.classList.remove('visible');
      statusBadge.textContent = '進行中';
      statusBadge.className = 'status-badge running';
      pauseBtn.textContent = '暫停';
      showAnswerBtn.disabled = false;

      // Reset hints
      for (let i = 0; i < 3; i++) {
        document.getElementById('hint-' + i).classList.remove('visible');
      }

      // Populate hint data
      currentTopic.hints.forEach((h, i) => {
        const card = document.getElementById('hint-' + i);
        card.querySelector('.hint-time').textContent = '提示 — 剩餘 ' + h.at + ' 分鐘時解鎖';
        card.querySelector('.hint-text').textContent = h.text;
      });

      // Disable start controls
      topicSelect.disabled = true;
      startBtn.disabled = true;

      updateTimerDisplay();
      startTimer();
    });

    // ── Timer logic ──
    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        if (isPaused) return;
        remainingSeconds--;
        updateTimerDisplay();
        checkHints();
        if (remainingSeconds <= 0) {
          clearInterval(timerInterval);
          timerEnded();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const m = Math.floor(remainingSeconds / 60);
      const s = remainingSeconds % 60;
      timerDisplay.textContent = String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');

      // Color changes
      timerDisplay.classList.remove('warning', 'danger');
      if (remainingSeconds <= 5 * 60) {
        timerDisplay.classList.add('danger');
      } else if (remainingSeconds <= 10 * 60) {
        timerDisplay.classList.add('warning');
      }
    }

    function checkHints() {
      if (!currentTopic) return;
      const minutesLeft = remainingSeconds / 60;
      currentTopic.hints.forEach((h, i) => {
        if (!hintsShown[i] && minutesLeft <= h.at) {
          hintsShown[i] = true;
          const card = document.getElementById('hint-' + i);
          card.querySelector('.hint-time').textContent = '提示 — 剩餘 ' + h.at + ' 分鐘';
          card.classList.add('visible');
        }
      });
    }

    function timerEnded() {
      statusBadge.textContent = '時間到';
      statusBadge.className = 'status-badge ended';
      pauseBtn.disabled = true;
      showAnswerBtn.disabled = true;
      showReference();
    }

    // ── Pause / Resume ──
    pauseBtn.addEventListener('click', () => {
      isPaused = !isPaused;
      if (isPaused) {
        pauseBtn.textContent = '繼續';
        statusBadge.textContent = '已暫停';
        statusBadge.className = 'status-badge paused';
      } else {
        pauseBtn.textContent = '暫停';
        statusBadge.textContent = '進行中';
        statusBadge.className = 'status-badge running';
      }
    });

    // ── Show Answer early ──
    showAnswerBtn.addEventListener('click', () => {
      if (!currentTopic) return;
      const confirmed = confirm('確定要提前睇參考答案？計時會停止。');
      if (!confirmed) return;
      clearInterval(timerInterval);
      isPaused = true;
      statusBadge.textContent = '已結束';
      statusBadge.className = 'status-badge ended';
      pauseBtn.disabled = true;
      showAnswerBtn.disabled = true;
      // Show all remaining hints
      currentTopic.hints.forEach((h, i) => {
        if (!hintsShown[i]) {
          hintsShown[i] = true;
          const card = document.getElementById('hint-' + i);
          card.querySelector('.hint-time').textContent = '提示 — 剩餘 ' + h.at + ' 分鐘';
          card.classList.add('visible');
        }
      });
      showReference();
    });

    // ── Show Reference Checklist ──
    function showReference() {
      if (!currentTopic) return;
      checklistEl.innerHTML = '';
      currentTopic.checklist.forEach((item, i) => {
        const li = document.createElement('li');
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.id = 'check-' + i;
        cb.addEventListener('change', () => {
          li.classList.toggle('checked', cb.checked);
          updateScore();
        });
        const label = document.createElement('label');
        label.htmlFor = 'check-' + i;
        label.textContent = item;
        label.style.cursor = 'pointer';
        li.appendChild(cb);
        li.appendChild(label);
        checklistEl.appendChild(li);
      });
      updateScore();
      referenceSection.classList.add('visible');
      referenceSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function updateScore() {
      if (!currentTopic) return;
      const total = currentTopic.checklist.length;
      const checked = checklistEl.querySelectorAll('input:checked').length;
      const pct = total > 0 ? (checked / total) * 100 : 0;
      scoreFill.style.width = pct + '%';
      scoreText.textContent = checked + ' / ' + total;
    }

    // ── Reset ──
    resetBtn.addEventListener('click', () => {
      clearInterval(timerInterval);
      timerInterval = null;
      remainingSeconds = totalSeconds;
      isPaused = false;
      currentTopic = null;
      hintsShown = [false, false, false];

      // Reset UI
      timerCard.style.display = 'none';
      promptBox.classList.remove('visible');
      notepadSection.classList.remove('visible');
      referenceSection.classList.remove('visible');
      timerDisplay.textContent = '35:00';
      timerDisplay.classList.remove('warning', 'danger');
      topicSelect.disabled = false;
      topicSelect.value = '';
      startBtn.disabled = true;
      pauseBtn.disabled = false;
      pauseBtn.textContent = '暫停';
      showAnswerBtn.disabled = false;

      for (let i = 0; i < 3; i++) {
        document.getElementById('hint-' + i).classList.remove('visible');
      }

      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>
</body>
</html>
